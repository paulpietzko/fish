<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Feierabend Countdown</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #movingImage {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 150px;
      }
    </style>
  </head>
  <body>
    <img id="movingImage" src="./fish.png" alt="Feierabend Bild" />

    <script>
      // URL-Parameter auslesen
      const urlParams = new URLSearchParams(window.location.search);
      const feierabendParam = urlParams.get("feierabend"); // z.B. HHMM oder HH:MM(:SS)
      if (!feierabendParam) {
        alert("Bitte einen 'feierabend'-Parameter in HH:MM angeben!");
        throw new Error("Feierabend-Parameter fehlt");
      }

      const now = new Date();
      let hour, minute, second = 0;

      if (feierabendParam.includes(":")) {
        const parts = feierabendParam.split(":").map(Number);
        hour = parts[0];
        minute = parts[1];
        second = parts[2] || 0; // optional
      } else if (feierabendParam.length === 4) {
        hour = Number(feierabendParam.slice(0, 2));
        minute = Number(feierabendParam.slice(2, 4));
      } else {
        alert("Fehlerhaftes Zeitformat! Nutze HHMM oder HH:MM(:SS).");
        throw new Error("Ung√ºltiges Zeitformat");
      }

      const feierabendTime = new Date();
      feierabendTime.setHours(hour, minute, second, 0);

      if (feierabendTime < now) {
        alert("Die angegebene Feierabend-Zeit liegt in der Vergangenheit!");
        throw new Error("Feierabend-Zeit in der Vergangenheit");
      }

      const image = document.getElementById("movingImage");
      const startX = window.innerWidth;
      const endX = -image.width;
      const totalDistance = startX - endX;

      const totalTime = feierabendTime - now; // Millisekunden bis Feierabend
      const speed = totalDistance / totalTime; // px/ms

      let posX = startX;
      let lastTime = performance.now();

      function animate(time) {
        const deltaTime = time - lastTime;
        lastTime = time;

        posX -= speed * deltaTime;
        if (posX < endX) posX = endX;
        image.style.left = posX + "px";

        if (posX > endX) {
          requestAnimationFrame(animate);
        }
      }

      requestAnimationFrame(animate);
    </script>
  </body>
</html>
